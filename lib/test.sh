#!/usr/bin/env bash

LIB_PATH="$( cd -- "$( dirname -- "${BASH_SOURCE[0]:-$0}"; )" &> /dev/null && pwd 2> /dev/null; )"
source "$LIB_PATH/logging.sh"

test_tool() {
    current_tool=$1
    command_output=$2
    pattern=$3
    verify_if_installed=${4:-}
    if [ -z "$current_tool" ]; then
        log_error "Tool was not passed to test_tool method - exiting"
        exit 1
    fi
    if [ -z "$pattern" ]; then
        log_error "Pattern was not passed to test_tool method for tool $current_tool - exiting"
        exit 1
    fi
    if ! grep -E "$pattern" <<< "$command_output" &>/dev/null; then
        if [ -n verify_if_installed ]; then
            log_debug "Tool $CURRENT_TOOL is not installed."
        else
            log_debug "Tool $CURRENT_TOOL doesn't work properly - verify installation."
        fi
        exit 1
    else
        exit 0
    fi
}