ARG GRADLE_VERSION=8.4-jdk17

FROM gradle:${GRADLE_VERSION} AS build

WORKDIR /src

ARG APKTOOL_VERSION=2.9.x

RUN git clone --depth 1 --single-branch --branch ${APKTOOL_VERSION} https://github.com/iBotPeaches/Apktool apktool

WORKDIR /src/apktool 

RUN gradle build shadowJar proguard

RUN cp brut.apktool/apktool-cli/build/libs/apktool-v*.jar brut.apktool/apktool-cli/build/libs/apktool.jar

FROM gcr.io/distroless/java11-debian11:nonroot
LABEL org.opencontainers.image.authors="Arqsz"

COPY --from=build /src/apktool/brut.apktool/apktool-cli/build/libs/apktool.jar /apktool/

ENTRYPOINT ["java", "-jar", "-Djava.io.tmpdir=/tmp", "-Duser.home=/tmp", "/apktool/apktool.jar"]