ARG RUBY_VERSION=3.0-alpine

FROM ruby:${RUBY_VERSION} AS build

RUN apk add --no-cache git build-base
WORKDIR /src

ARG CEWL_VERSION=5.4.3.2

RUN git clone --depth 1 --single-branch --branch ${CEWL_VERSION} https://github.com/digininja/CeWL

WORKDIR /src/CeWL

RUN gem install bundler && bundle install

FROM ruby:${RUBY_VERSION} AS final

COPY --from=build /src/CeWL/cewl_lib.rb /src/CeWL/cewl.rb /usr/bin/
COPY --from=build /usr/local/bundle /usr/local/bundle

ENTRYPOINT ["/usr/bin/cewl.rb"]