ARG RUBY_VERSION=3.1.2

FROM ruby:${RUBY_VERSION}-alpine AS build

RUN apk add --no-cache git build-base
WORKDIR /src

RUN git clone https://github.com/digininja/CeWL

WORKDIR /src/CeWL

RUN gem install bundler && bundle install

FROM ruby:${RUBY_VERSION}-alpine AS final

COPY --from=build /src/CeWL/cewl_lib.rb /src/CeWL/cewl.rb /usr/bin/
COPY --from=build /usr/local/bundle /usr/local/bundle

ENTRYPOINT ["/usr/bin/cewl.rb"]