#!/usr/bin/env bash

SCRIPTPATH="$( cd -- "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )"
CURRENT_TOOL=$(basename $SCRIPTPATH)
CONTAINER_IMAGE=c4p/$CURRENT_TOOL:latest

docker build --force-rm \
    -t $CONTAINER_IMAGE -f $SCRIPTPATH/Dockerfile $SCRIPTPATH

if ! grep "$CURRENT_TOOL()" $HOME/.c4p_config &>/dev/null; then
    cat >> $HOME/.c4p_config << EOM
$CURRENT_TOOL() {
    $SCRIPTPATH/run.sh "\$@"
}

EOM
fi