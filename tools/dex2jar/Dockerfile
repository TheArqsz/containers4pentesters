ARG GRADLE_VERSION=7.6.4-jdk11-alpine

FROM gradle:${GRADLE_VERSION} AS build

RUN apk add --no-cache git unzip
WORKDIR /src

ARG DEX2JAR_VERSION=2.x

RUN git clone --depth 1 --single-branch --branch ${DEX2JAR_VERSION} https://github.com/pxb1988/dex2jar

WORKDIR /src/dex2jar

RUN ./gradlew distZip

WORKDIR /src/dex2jar/dex-tools/build/distributions

RUN unzip dex-tools-2.x.zip

FROM openjdk:19-alpine

COPY --from=build /src/dex2jar/dex-tools/build/distributions/dex-tools-2.x/bin /dex2jar/bin
COPY --from=build /src/dex2jar/dex-tools/build/distributions/dex-tools-2.x/lib /dex2jar/lib
COPY --from=build /src/dex2jar/dex-tools/build/distributions/dex-tools-2.x/d2j-dex2jar.sh /dex2jar/d2j-dex2jar

ENTRYPOINT ["/dex2jar/d2j-dex2jar"]