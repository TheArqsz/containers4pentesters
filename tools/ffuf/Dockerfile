ARG GO_VERSION=1.18.3-alpine

FROM golang:${GO_VERSION} AS build

RUN apk add --no-cache git
WORKDIR /src

ARG FFUF_VERSION=v1.5.0

RUN git clone --depth 1 --single-branch --branch ${FFUF_VERSION} https://github.com/ffuf/ffuf

WORKDIR /src/ffuf

RUN go get && CGO_ENABLED=0 go build -o /ffuf .

FROM gcr.io/distroless/base

COPY --from=build /ffuf /usr/bin/ffuf

ENTRYPOINT ["/usr/bin/ffuf"]