#!/usr/bin/env bash

SCRIPTPATH="$( cd -- "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )"
CURRENT_TOOL=$(basename $SCRIPTPATH)
CONTAINER_RUNTIME=docker
CONTAINER_NAME=c4p-$CURRENT_TOOL
CONTAINER_IMAGE=c4p/$CURRENT_TOOL:latest
HOME=${HOME:-/tmp}
DOCKER_NETWORK_TYPE=${DOCKER_NETWORK_TYPE:-host}

if [ "$DEBIAN_FRONTEND" = "noninteractive" ]; then
    $CONTAINER_RUNTIME run \
        -i --rm --name $CONTAINER_NAME \
        --network $DOCKER_NETWORK_TYPE \
        --user `id -u`:`id -g` \
        --volume $HOME:$HOME \
        --volume /tmp:/tmp \
        $CONTAINER_IMAGE "$@"
else
    $CONTAINER_RUNTIME run \
        -it --rm --name $CONTAINER_NAME \
        --network $DOCKER_NETWORK_TYPE \
        --user `id -u`:`id -g` \
        --volume $HOME:$HOME \
        --volume /tmp:/tmp \
        $CONTAINER_IMAGE "$@"
fi