ARG GO_VERSION=1.18.3-alpine

FROM golang:${GO_VERSION} AS build

RUN apk add --no-cache git
WORKDIR /src

ARG GOBUSTER_VERSION=v3.1.0

RUN git clone --depth 1 --single-branch --branch ${GOBUSTER_VERSION} https://github.com/OJ/gobuster.git

WORKDIR /src/gobuster

RUN CGO_ENABLED=0 go build -o /gobuster .

FROM gcr.io/distroless/base

COPY --from=build /gobuster /usr/bin/gobuster

ENTRYPOINT ["/usr/bin/gobuster"]