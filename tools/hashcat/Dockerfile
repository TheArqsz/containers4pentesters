FROM debian:bullseye-slim as build

ARG HASHCAT_VERSION=v6.2.5
ARG HASHCAT_UTILS_VERSION=v1.9
ARG HCXTOOLS_VERSION=6.2.5
ARG HCXDUMPTOOL_VERSION=6.2.5
ARG HCXKEYS_VERSION=master

ENV DEBIAN_FRONTEND=noninteractive
RUN apt update \
    && apt install -y \
        git build-essential autoconf automake \
        ocl-icd-libopencl1 clinfo pkg-config \
        libcurl4-openssl-dev libssl-dev zlib1g-dev libcurl4-openssl-dev libssl-dev \
    && rm -rf /var/cache/apt/*

WORKDIR /src

RUN git clone --depth 1 --single-branch --branch ${HASHCAT_VERSION} https://github.com/hashcat/hashcat

WORKDIR /src/hashcat

RUN make && make install -j4

# FROM gcr.io/distroless/cc

# COPY --from=build /usr/local/bin/hashcat /usr/local/bin/hashcat  
# COPY --from=build /usr/local/share/doc/hashcat /usr/local/share/doc/hashcat
# COPY --from=build /usr/local/share/hashcat /usr/local/share/hashcat

# ENTRYPOINT ["/usr/local/bin/hashcat"]