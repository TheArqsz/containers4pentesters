FROM debian:bullseye-slim as build

WORKDIR /src

ENV DEBIAN_FRONTEND=noninteractive
RUN apt update \
    && apt install -y \
        git \
        ca-certificates \
        build-essential \
        wget \
        libssl-dev \ 
        libnet-ssleay-perl \
        perl \
    && rm -rf /var/cache/apt/*

ARG NIKTO_VERSION=2.1.6

RUN git clone --depth 1 --single-branch --branch ${NIKTO_VERSION} https://github.com/sullo/nikto 

WORKDIR /src/nikto

FROM gcr.io/distroless/base

COPY --from=build /usr/bin/perl  /usr/bin/perl 
COPY --from=build /lib /lib
COPY --from=build /usr/share/perl /usr/share/perl
COPY --from=build /usr/lib/x86_64-linux-gnu/perl /usr/lib/x86_64-linux-gnu/perl
COPY --from=build /usr/lib/x86_64-linux-gnu/perl5 /usr/lib/x86_64-linux-gnu/perl5
COPY --from=build /src/nikto /src/nikto

ENTRYPOINT ["/usr/bin/perl", "/src/nikto/program/nikto.pl"]