FROM debian:bullseye-slim as build

ENV DEBIAN_FRONTEND=noninteractive
RUN apt update \
    && apt install -y \
        git \
        python3-minimal \
        python3-venv \
    && rm -rf /var/cache/apt/*

WORKDIR /src

ARG QARK_VERSION=4.0.0

RUN python3 -m venv /src/venv && \
    /src/venv/bin/pip install qark==${QARK_VERSION}

FROM gcr.io/distroless/python3-debian11

COPY --from=build /src /src

ENTRYPOINT ["/src/venv/bin/python3", "/src/venv/bin/qark"]