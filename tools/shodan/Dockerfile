FROM debian:bullseye-slim as build

ENV DEBIAN_FRONTEND=noninteractive
RUN apt update \
    && apt install -y \
        wget \
        python3-minimal \
        python3-venv \
        unzip \
    && rm -rf /var/cache/apt/*

WORKDIR /src

ARG SHODAN_VERSION=1.28.0

RUN wget https://github.com/achillean/shodan-python/archive/refs/tags/${SHODAN_VERSION}.zip -O /src/shodan.zip && \
    unzip /src/shodan.zip && mv shodan-python-${SHODAN_VERSION} shodan

RUN python3 -m venv /src/shodan/venv && \
    /src/shodan/venv/bin/pip install -r /src/shodan/requirements.txt && \
    /src/shodan/venv/bin/easy_install /src/shodan/

WORKDIR /src/shodan

FROM gcr.io/distroless/python3-debian11
LABEL org.opencontainers.image.authors="Arqsz"

COPY --from=build /src/shodan /src/shodan

ENTRYPOINT ["/src/shodan/venv/bin/python", "/src/shodan/venv/bin/shodan"]