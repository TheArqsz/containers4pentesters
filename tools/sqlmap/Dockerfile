FROM debian:bullseye-slim as build

# Install dependencies
ENV DEBIAN_FRONTEND=noninteractive
RUN apt update \
    && apt install -y \
        git \
        python3-minimal \
    && rm -rf /var/cache/apt/*

WORKDIR /src

RUN git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git 

RUN mkdir -p /.local/share/sqlmap

WORKDIR /src/sqlmap

FROM gcr.io/distroless/python3-debian11

COPY --from=build /src/sqlmap /src/sqlmap
COPY --from=build /.local/share/sqlmap /.local/share/sqlmap

ENTRYPOINT ["python", "/src/sqlmap/sqlmap.py"]