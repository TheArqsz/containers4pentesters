FROM debian:bullseye-slim as build

ENV DEBIAN_FRONTEND=noninteractive
RUN apt update \
    && apt install -y \
        git \
        python3-minimal \
    && rm -rf /var/cache/apt/*

WORKDIR /src

ARG SQLMAP_VERSION=1.6.6

RUN git clone --depth 1 --single-branch --branch ${SQLMAP_VERSION} https://github.com/sqlmapproject/sqlmap.git 

WORKDIR /src/sqlmap

FROM gcr.io/distroless/python3-debian11

COPY --from=build /src/sqlmap /src/sqlmap

ENTRYPOINT ["python", "/src/sqlmap/sqlmap.py"]