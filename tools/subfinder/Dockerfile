ARG GO_VERSION=1.22.1-alpine

FROM golang:${GO_VERSION} AS build

RUN apk add --no-cache wget unzip build-base
WORKDIR /src

ARG SUBFINDER_VERSION=2.6.6

RUN wget -q -k https://github.com/projectdiscovery/subfinder/archive/refs/tags/v${SUBFINDER_VERSION}.zip && \
    unzip v${SUBFINDER_VERSION}.zip && \
    rm v${SUBFINDER_VERSION}.zip && \
    mv /src/subfinder-${SUBFINDER_VERSION} /src/subfinder

WORKDIR /src/subfinder/v2/cmd/subfinder

RUN go mod download -x && CGO_ENABLED=0 go build -v -o /subfinder

FROM alpine:3.19
LABEL org.opencontainers.image.authors="Arqsz"
# Based on https://github.com/projectdiscovery/subfinder/blob/dev/Dockerfile

RUN apk add --no-cache bind-tools ca-certificates \
    && rm -rf /var/cache/apk/*

COPY --from=build /subfinder /usr/local/bin/subfinder

ENV PATH="/usr/local/bin:$PATH"

ENTRYPOINT ["subfinder"]
CMD [ "-help" ]